<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 3.8.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/site.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/site.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yoursite.com","root":"/","scheme":"Mist","version":"7.7.2","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="never giveup stronger survival">
<meta property="og:type" content="website">
<meta property="og:title" content="dang&#39;s technology blog">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="dang&#39;s technology blog">
<meta property="og:description" content="never giveup stronger survival">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="dang&#39;s technology blog">
<meta name="twitter:description" content="never giveup stronger survival">

<link rel="canonical" href="http://yoursite.com/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>dang's technology blog - Coding Fighting</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">dang's technology blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">Coding Fighting</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index">
            

  <div class="posts-expand">
        
  
  
  <article itemscope="" itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/posts/undefined/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/ava.png">
      <meta itemprop="name" content="dangsenlin">
      <meta itemprop="description" content="never giveup stronger survival">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="dang's technology blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/posts/undefined/" class="post-title-link" itemprop="url">数组方法总结</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-07-07 00:01:16" itemprop="dateCreated datePublished" datetime="2020-07-07T00:01:16+08:00">2020-07-07</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope="" itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/posts/65284/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/ava.png">
      <meta itemprop="name" content="dangsenlin">
      <meta itemprop="description" content="never giveup stronger survival">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="dang's technology blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/posts/65284/" class="post-title-link" itemprop="url">盒模型与BFC</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-07-06 03:36:09 / 修改时间：04:03:16" itemprop="dateCreated datePublished" datetime="2020-07-06T03:36:09+08:00">2020-07-06</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/source/categories/HTML/" itemprop="url" rel="index"><span itemprop="name">HTML</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <ul>
<li>盒模型是可以认为每个html标签(如div)都是一个个盒子，盒子根据一定的规则排列，盒子之中还有盒子。</li>
<li>具有 BFC 特性的元素可以看作是隔离了的独立容器，容器里面的元素不会在布局上影响到外面的元素。
&lt;!-- more --&gt;</li>
</ul>
<h1>盒模型</h1>
<p>分为IE盒模型和标准盒模型</p>
<h2>标准盒模型</h2>
<p>&lt;font color=&quot;red&quot;&gt;width = 内容的宽度(content)&lt;/font&gt;</p>
<h2>IE盒模型</h2>
<p>&lt;font color=&quot;red&quot;&gt;width = 内容的宽度(content) + padding + border&lt;/font&gt;</p>
<p><em>设置</em>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">box-sizing:content-box(默认，标准盒模型)</span><br><span class="line">box-sizing:border-box(IE盒模型)</span><br></pre></td></tr></table></figure></p>
<h1>BFC</h1>
<h2>触发</h2>
<ul>
<li>body 根元素</li>
<li>浮动元素：float 除 none 以外的值绝对定位元素：position (absolute、fixed)</li>
<li>display 为 inline-block、table-cells、flex</li>
<li>overflow 除了 visible 以外的值 (hidden、auto、scroll)</li>
</ul>
<h2>BFC特性</h2>
<ol>
<li>在同一个BFC中margin会发生重叠</li>
<li>清除浮动(防止float高度塌陷)</li>
<li>防止浮动遮挡</li>
</ol>
<p><a href="https://www.zhihu.com/search?type=content&amp;q=BFC" target="_blank" rel="noopener">参考</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope="" itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/posts/2249/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/ava.png">
      <meta itemprop="name" content="dangsenlin">
      <meta itemprop="description" content="never giveup stronger survival">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="dang's technology blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/posts/2249/" class="post-title-link" itemprop="url">JS杂记</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-07-04 12:14:18" itemprop="dateCreated datePublished" datetime="2020-07-04T12:14:18+08:00">2020-07-04</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-07-07 00:00:52" itemprop="dateModified" datetime="2020-07-07T00:00:52+08:00">2020-07-07</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/source/categories/JavaScript/" itemprop="url" rel="index"><span itemprop="name">JavaScript</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>扁平化等，一个JS记录，便于翻阅
&lt;!-- more --&gt;</p>
<h3>执行一次，打印结果+1的函数</h3>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">function addFun()&#123;</span><br><span class="line">    let num = 0</span><br><span class="line">    return function()&#123;</span><br><span class="line">        num++</span><br><span class="line">        console.log(num)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">let add = addFun()</span><br><span class="line">add()  // 1</span><br><span class="line">add()  // 2</span><br><span class="line">add()  // 3</span><br></pre></td></tr></table></figure></p>
<p>或
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">let add = (function addFun()&#123;</span><br><span class="line">    let num = 0</span><br><span class="line">    return function()&#123;</span><br><span class="line">        num++</span><br><span class="line">        console.log(num)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)()</span><br><span class="line">add()  // 1</span><br><span class="line">add()  // 2</span><br><span class="line">add()  // 3</span><br></pre></td></tr></table></figure></p>
<h3>画一个三角形</h3>
<p>CSS：
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#demo&#123;</span><br><span class="line">    width:0px;  </span><br><span class="line">    height:0px;  </span><br><span class="line">    border:40px solid transparent;</span><br><span class="line">    border-bottom:80px solid red;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>&lt;font color=&quot;red&quot;&gt;盒子的边框（border）严格来说是梯形，将width和height都设置为0后这时就是正方形中四个三角形，此时需将其他三个三角形隐藏即可&lt;/font&gt;</p>
<h3>数组扁平化</h3>
<p>递归:
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">function flat(arr) &#123;</span><br><span class="line">    let res = []</span><br><span class="line">    for(let i = 0 ; i &lt; arr.length ; i++) &#123;</span><br><span class="line">        if(Array.isArray(arr[i]))&#123;</span><br><span class="line">            res = res.concat(flat(arr[i]))</span><br><span class="line">        &#125;else &#123;</span><br><span class="line">            res.push(arr[i])</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return res</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>仅适用于数字项：
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">function flat(arr)&#123;</span><br><span class="line">    return res = arr.toString().split(&apos;,&apos;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>reduce方法：
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">function flat(arr) &#123;</span><br><span class="line">    return arr.reduce((sum, current) =&gt; &#123;</span><br><span class="line">        return sum.concat(Array.isArray(current) ? flat(current): current)</span><br><span class="line">    &#125;, [])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3>关于promise的一道题</h3>
<p>点击提交按钮，如果短时间内连续点击多次，会发送多次相同请求，为了避免这种情况，实现一个通用的包装函数singlePipe,使得被包装的请求函数，在请求过程中如果再次调用该函数，不会发出请求，直到该次请求完成后才能再次发出请求
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">const singlePipe = function(promiseFunc) &#123;</span><br><span class="line">  // TODO</span><br><span class="line">&#125;</span><br><span class="line">//测试</span><br><span class="line">const promiseFunc = function(data) &#123;</span><br><span class="line">  return new Promise((resolve) =&gt;&#123;</span><br><span class="line">    setTime(()=&gt; resolve(data),1000)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line">const request = singlePipe(promiseFunc) </span><br><span class="line">request(1).then(data=&gt;console.log(data)) //1</span><br><span class="line">request(2).then(data=&gt;console.log(data)) //无反应</span><br><span class="line">setTimeout(()=&gt;&#123;</span><br><span class="line">  request(3).then(data=&gt;console.log(data)) //3</span><br><span class="line">&#125;,1000)</span><br></pre></td></tr></table></figure></p>
<p>实现：
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">const singlePipe = function (promiseFunc) &#123;</span><br><span class="line">  let requesting = false;</span><br><span class="line">  return function (params) &#123;</span><br><span class="line">    if (requesting) &#123;</span><br><span class="line">      return &#123;</span><br><span class="line">        then: function () &#123;&#125;,</span><br><span class="line">        reject: function () &#123;&#125;</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    requesting = true;</span><br><span class="line">    const promise = promiseFunc(params);</span><br><span class="line">    return new Promise((resolve, reject) =&gt; &#123;</span><br><span class="line">      promise.then((data) =&gt; &#123;</span><br><span class="line">        resolve(data);</span><br><span class="line">        requesting = false;</span><br><span class="line">      &#125;).catch((error) =&gt; &#123;</span><br><span class="line">        reject(error);</span><br><span class="line">        requesting = false;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const promiseFunc = function (data) &#123;</span><br><span class="line">  return new Promise((resolve) =&gt; &#123;</span><br><span class="line">    setTimeout(() =&gt; resolve(data), 1000)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//测试</span><br><span class="line">const request = singlePipe(promiseFunc);</span><br><span class="line"></span><br><span class="line">request(1).then(data =&gt; &#123;</span><br><span class="line">  console.log(data);</span><br><span class="line">&#125;) // 1</span><br><span class="line"></span><br><span class="line">request(2).then(data =&gt; &#123;</span><br><span class="line">  console.log(data);</span><br><span class="line">&#125;) // 无反应</span><br><span class="line"></span><br><span class="line">setTimeout(() =&gt; &#123;</span><br><span class="line">  request(3).then(data =&gt; &#123;</span><br><span class="line">    console.log(data);</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;, 2000) // 3</span><br></pre></td></tr></table></figure></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope="" itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/posts/20004/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/ava.png">
      <meta itemprop="name" content="dangsenlin">
      <meta itemprop="description" content="never giveup stronger survival">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="dang's technology blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/posts/20004/" class="post-title-link" itemprop="url">关于布局</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-07-04 12:14:02" itemprop="dateCreated datePublished" datetime="2020-07-04T12:14:02+08:00">2020-07-04</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-07-06 03:35:01" itemprop="dateModified" datetime="2020-07-06T03:35:01+08:00">2020-07-06</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/source/categories/CSS/" itemprop="url" rel="index"><span itemprop="name">CSS</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>关于居中，三栏布局等的一个总结</p>
<p>&lt;!-- more --&gt;</p>
<h1>居中</h1>
<p>居中根据条件适用分为<strong>定宽高</strong>和<strong>不定宽高</strong>
定宽高：</p>
<ul>
<li>absolute + margin(取值auto)</li>
<li>absolute + margin(值为宽度的负50%)
不定宽高：</li>
<li>text-align(水平居中) + vertical-align(垂直居中)</li>
<li>absolute + transform</li>
<li>flex</li>
<li>gird</li>
</ul>
<h2>absolute + margin(auto)</h2>
<p>HTML:
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;div class=&quot;fa&quot;&gt;</span><br><span class="line">    &lt;div class=&quot;so&quot;&gt;&lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure></p>
<p>CSS:
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">.fa&#123;</span><br><span class="line">    width: 500px;</span><br><span class="line">    height: 500px;</span><br><span class="line">    border: 1px solid black;</span><br><span class="line">    position: relative;</span><br><span class="line">&#125;</span><br><span class="line">.so&#123;</span><br><span class="line">    width: 100px;</span><br><span class="line">    height: 100px;</span><br><span class="line">    background-color: lightblue;</span><br><span class="line">    position: absolute;</span><br><span class="line">    left: 0;</span><br><span class="line">    right: 0;</span><br><span class="line">    top: 0;</span><br><span class="line">    bottom: 0;</span><br><span class="line">    margin: auto;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>&lt;font color=&quot;red&quot;&gt;绝对定位之后各个方向设置为0,再设置margin:0&lt;/font&gt;</p>
<h2>absolute + margin(负一半)</h2>
<p>HTML：
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;div class=&quot;fa&quot;&gt;</span><br><span class="line">    &lt;div class=&quot;so&quot;&gt;&lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure></p>
<p>CSS:
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">.fa&#123;</span><br><span class="line">    width: 500px;</span><br><span class="line">    height: 500px;</span><br><span class="line">    border: 1px solid black;</span><br><span class="line">    position: relative;</span><br><span class="line">&#125;</span><br><span class="line">.so&#123;</span><br><span class="line">    width: 100px;</span><br><span class="line">    height: 100px;</span><br><span class="line">    background-color: lightblue;</span><br><span class="line">    position: absolute;</span><br><span class="line">    left: 50%;</span><br><span class="line">    top: 50%;</span><br><span class="line">    margin: -50px 0 0 -50px;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>&lt;font color=&quot;red&quot;&gt;left:50%是将父元素的中线和子元素的左侧对其，margin-left:-50%是将子元素的中线和父元素左侧对齐，两者结合即水平居中(left是相对于父元素，margin是相对于本身)&lt;/font&gt;</p>
<h2>text-align(水平居中)</h2>
<p>作用于行内元素</p>
<h2>absolute + transform</h2>
<p>HTML:
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;div class=&quot;fa&quot;&gt;</span><br><span class="line">    &lt;div class=&quot;so&quot;&gt;&lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure></p>
<p>CSS:
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">.fa&#123;</span><br><span class="line">    width: 500px;</span><br><span class="line">    height: 500px;</span><br><span class="line">    border: 1px solid black;</span><br><span class="line">    position: relative;</span><br><span class="line">&#125;</span><br><span class="line">.so&#123;</span><br><span class="line">    width: 100px;</span><br><span class="line">    height: 100px;</span><br><span class="line">    background-color: lightblue;</span><br><span class="line">    position: absolute;</span><br><span class="line">    left: 50%;</span><br><span class="line">    top: 50%;</span><br><span class="line">    transform: translate(-50%,-50%);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>&lt;font color=&quot;red&quot;&gt;transform: tranlate(-50%,-50%)作用相当于margin(移动自身比例)&lt;/font&gt;</p>
<h2>flex</h2>
<p>HTML:
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;div class=&quot;fa&quot;&gt;</span><br><span class="line">    &lt;div class=&quot;so&quot;&gt;&lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure></p>
<p>CSS:
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">.fa&#123;</span><br><span class="line">    width: 500px;</span><br><span class="line">    height: 500px;</span><br><span class="line">    border: 1px solid black;</span><br><span class="line">    display: flex;</span><br><span class="line">    justify-content: center;</span><br><span class="line">    align-items: center;</span><br><span class="line">&#125; </span><br><span class="line">.so&#123;</span><br><span class="line">    width: 100px;</span><br><span class="line">    height: 100px;</span><br><span class="line">    background-color: lightblue;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>&lt;font color=&quot;red&quot;&gt;代码优雅，优先使用&lt;/font&gt;</p>
<h2>grid</h2>
<p>HTML:
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;div class=&quot;fa&quot;&gt;</span><br><span class="line">    &lt;div class=&quot;so&quot;&gt;&lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure></p>
<p>CSS:
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">.fa&#123;</span><br><span class="line">    width: 500px;</span><br><span class="line">    height: 500px;</span><br><span class="line">    border: 1px solid black;</span><br><span class="line">    display: grid;</span><br><span class="line">&#125; </span><br><span class="line">.so&#123;</span><br><span class="line">    width: 100px;</span><br><span class="line">    height: 100px;</span><br><span class="line">    background-color: lightblue;</span><br><span class="line">    align-self: center;</span><br><span class="line">    justify-self: center;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>优秀文章参考
<a href="https://juejin.im/post/5b9a4477f265da0ad82bf921#heading-8" target="_blank" rel="noopener">1</a>
<a href="https://juejin.im/post/5b9a4477f265da0ad82bf921#heading-1" target="_blank" rel="noopener">2</a></p>
<h1>三栏布局</h1>
<p>实现左右固定，中间自适应：</p>
<ul>
<li>float</li>
<li>双飞翼</li>
<li>flex</li>
</ul>
<h2>float</h2>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;style&gt;</span><br><span class="line">	.left &#123;</span><br><span class="line">	    float: left;</span><br><span class="line">	    height: 200px;</span><br><span class="line">	    width: 100px;</span><br><span class="line">	    background-color: red;</span><br><span class="line">	&#125;</span><br><span class="line">	.right &#123;</span><br><span class="line">	    width: 200px;</span><br><span class="line">	    height: 200px;</span><br><span class="line">	    background-color: blue;</span><br><span class="line">	    float: right;</span><br><span class="line">	&#125;</span><br><span class="line">	.main &#123;</span><br><span class="line">	    margin-left: 120px;</span><br><span class="line">	    margin-right: 220px;</span><br><span class="line">	    height: 200px;</span><br><span class="line">	    background-color: green;</span><br><span class="line">	&#125;</span><br><span class="line">    &lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;div class=&quot;container&quot;&gt;</span><br><span class="line">        &lt;div class=&quot;left&quot;&gt;&lt;/div&gt;</span><br><span class="line">        &lt;div class=&quot;right&quot;&gt;&lt;/div&gt;</span><br><span class="line">        &lt;div class=&quot;main&quot;&gt;&lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure></p>
<p>&lt;font color=&quot;red&quot;&gt;左右分别往左右浮动，中间设置margin-left/right&lt;/font&gt;</p>
<h2>双飞翼</h2>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;style&gt;</span><br><span class="line">        .content &#123;</span><br><span class="line">  	    float: left;</span><br><span class="line">  	    width: 100%;</span><br><span class="line">        &#125;</span><br><span class="line">        .main &#123;</span><br><span class="line">  	    height: 200px;</span><br><span class="line">  	    margin-left: 110px;</span><br><span class="line">  	    margin-right: 220px;</span><br><span class="line">  	    background-color: green;</span><br><span class="line">        &#125;</span><br><span class="line">	.left &#123;</span><br><span class="line">	    float: left;</span><br><span class="line">	    height: 200px;</span><br><span class="line">	    width: 100px;</span><br><span class="line">	    margin-left: -100%;</span><br><span class="line">	    background-color: red;</span><br><span class="line">	&#125;</span><br><span class="line">	.right &#123;</span><br><span class="line">	    width: 200px;</span><br><span class="line">	    height: 200px;</span><br><span class="line">	    float: right;</span><br><span class="line">	    margin-left: -200px;</span><br><span class="line">	    background-color: blue;</span><br><span class="line">	&#125;	</span><br><span class="line">    &lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;div class=&quot;content&quot;&gt;</span><br><span class="line">        &lt;div class=&quot;main&quot;&gt;&lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;div class=&quot;left&quot;&gt;&lt;/div&gt;</span><br><span class="line">    &lt;div class=&quot;right&quot;&gt;&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure></p>
<p>&lt;font color=&quot;red&quot;&gt;中间内容左移并占满，左内容float:left并margin-left:-100%(左边框和中间内容左边框对齐),右内容float:left并margin-left:-width&lt;/font&gt;</p>
<h2>flex</h2>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;style&gt;</span><br><span class="line">	.container &#123;</span><br><span class="line">            display: flex;</span><br><span class="line">	&#125;</span><br><span class="line">	.main &#123;</span><br><span class="line">            flex-grow: 1;</span><br><span class="line">	    height: 300px;</span><br><span class="line">	    background-color: red;</span><br><span class="line">	&#125;</span><br><span class="line">	.left &#123;</span><br><span class="line">	    order: -1;</span><br><span class="line">	    flex: 0 1 200px;</span><br><span class="line">	    margin-right: 20px;</span><br><span class="line">	    height: 300px;</span><br><span class="line">	    background-color: blue;</span><br><span class="line">	&#125;</span><br><span class="line">	.right &#123;</span><br><span class="line">	    flex: 0 1 100px;</span><br><span class="line">            margin-left: 20px;</span><br><span class="line">	    height: 300px;</span><br><span class="line">	    background-color: green;</span><br><span class="line">	&#125;</span><br><span class="line">    &lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;div class=&quot;container&quot;&gt;</span><br><span class="line">	&lt;div class=&quot;main&quot;&gt;&lt;/div&gt;</span><br><span class="line">	&lt;div class=&quot;left&quot;&gt;&lt;/div&gt;</span><br><span class="line">	&lt;div class=&quot;right&quot;&gt;&lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure></p>
<p>&lt;font color=&quot;red&quot;&gt;order进行排序，中间内容flex-grow:1即放大占满，左右内容margin + flex-gorw:0(不放大)，flex-shrink:1(也不缩小)，flex-basis:width(占据固定空间)&lt;/font&gt;</p>
<p><a href="https://zhuanlan.zhihu.com/p/25070186" target="_blank" rel="noopener">参考</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope="" itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/posts/31167/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/ava.png">
      <meta itemprop="name" content="dangsenlin">
      <meta itemprop="description" content="never giveup stronger survival">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="dang's technology blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/posts/31167/" class="post-title-link" itemprop="url">浏览器渲染过程</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-07-02 15:12:16 / 修改时间：16:16:43" itemprop="dateCreated datePublished" datetime="2020-07-02T15:12:16+08:00">2020-07-02</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/source/categories/浏览器/" itemprop="url" rel="index"><span itemprop="name">浏览器</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>浏览器拿到服务器的资源是如何处理的？</p>
<p>&lt;!-- more --&gt;</p>
<p>资源主要包括HTML,CSS,JS等，先看下图：
<img src="https://imgkr.cn-bj.ufileos.com/3db9a442-df04-4e79-902a-31ac102fe5ba.png" alt="pic"></p>
<p>主要步骤：</p>
<ol>
<li>根据HTML构建DOM</li>
<li>根据CSS构建CSSOM</li>
<li>合并DOM和CSSOM生成Render Tree</li>
<li>Layout: 根据渲染对象计算出每个对象的尺寸和位置等</li>
<li>painting： 将上一步的结果渲染到页面上</li>
</ol>
<p>window.onload和DOMcontentLoaded有什么区别？</p>
<ul>
<li>HTML parser构建完DOM树后document会派发DOMcontentLoaded事件</li>
<li>所有资源(img等)全部加载完毕才会触发onload事件</li>
</ul>
<p>script标签中defer和async分别什么意思？
<img src="https://imgkr.cn-bj.ufileos.com/f5440a32-f552-4aaa-a83e-f0621369c413.png" alt="pic">
说明：如果没有defer和async那么script的下载和执行都会阻塞
有defer下载时不阻塞，会在DOM构建完，DOMcontentLoaded之前执行
有async下载时不阻塞，下载完立即执行，执行时阻塞</p>
<p>CSS会阻塞HTML的解析和渲染吗？
CSS不会阻塞HTML的解析但是会阻塞HTML的渲染，所以感观上CSS会阻塞页面的，且css加载会阻塞后面的js语句的执行</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope="" itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/posts/40340/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/ava.png">
      <meta itemprop="name" content="dangsenlin">
      <meta itemprop="description" content="never giveup stronger survival">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="dang's technology blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/posts/40340/" class="post-title-link" itemprop="url">Event Loop</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-06-28 16:54:53" itemprop="dateCreated datePublished" datetime="2020-06-28T16:54:53+08:00">2020-06-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-07-01 22:27:40" itemprop="dateModified" datetime="2020-07-01T22:27:40+08:00">2020-07-01</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/source/categories/浏览器/" itemprop="url" rel="index"><span itemprop="name">浏览器</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><strong>执行栈与任务队列</strong>：
由于JS是单线程的，将同步代码与异步代码进行了区分：
遇到同步代码总是放入执行栈中，异步代码放入任务队列中，总是清空任务队列(总是先执行同步代码),再查询任务队列中有没有异步代码，有则执行。</p>
<p>&lt;!-- more --&gt;</p>
<h1>浏览器环境</h1>
<p><strong>执行流程：</strong>
将script整个看成一个task，
执行机制：
1.执行<strong>一个</strong>task(第一次执行同步代码)
2.执行<strong>所有</strong>microtask
3.重复1，2直到清空</p>
<p>代码示例：
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">function sleep(time) &#123;</span><br><span class="line">  let startTime = new Date()</span><br><span class="line">  while (new Date() - startTime &lt; time) &#123;&#125;</span><br><span class="line">  console.log(&apos;1s over&apos;)</span><br><span class="line">&#125;</span><br><span class="line">setTimeout(() =&gt; &#123;</span><br><span class="line">  console.log(&apos;setTimeout - 1&apos;)</span><br><span class="line">  setTimeout(() =&gt; &#123;</span><br><span class="line">      console.log(&apos;setTimeout - 1 - 1&apos;)</span><br><span class="line">      sleep(1000)</span><br><span class="line">  &#125;)</span><br><span class="line">  new Promise(resolve =&gt; resolve()).then(() =&gt; &#123;</span><br><span class="line">      console.log(&apos;setTimeout - 1 - then&apos;)</span><br><span class="line">      new Promise(resolve =&gt; resolve()).then(() =&gt; &#123;</span><br><span class="line">          console.log(&apos;setTimeout - 1 - then - then&apos;)</span><br><span class="line">      &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">  sleep(1000)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">setTimeout(() =&gt; &#123;</span><br><span class="line">  console.log(&apos;setTimeout - 2&apos;)</span><br><span class="line">  setTimeout(() =&gt; &#123;</span><br><span class="line">      console.log(&apos;setTimeout - 2 - 1&apos;)</span><br><span class="line">      sleep(1000)</span><br><span class="line">  &#125;)</span><br><span class="line">  new Promise(resolve =&gt; resolve()).then(() =&gt; &#123;</span><br><span class="line">      console.log(&apos;setTimeout - 2 - then&apos;)</span><br><span class="line">      new Promise(resolve =&gt; resolve()).then(() =&gt; &#123;</span><br><span class="line">          console.log(&apos;setTimeout - 2 - then - then&apos;)</span><br><span class="line">      &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">  sleep(1000)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<p>执行结果（浏览器）：
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">setTimeout - 1 //1为单个task</span><br><span class="line">1s over</span><br><span class="line">setTimeout - 1 - then</span><br><span class="line">setTimeout - 1 - then - then </span><br><span class="line">setTimeout - 2 //2为单个task</span><br><span class="line">1s over</span><br><span class="line">setTimeout - 2 - then</span><br><span class="line">setTimeout - 2 - then - then</span><br><span class="line">setTimeout - 1 - 1</span><br><span class="line">1s over</span><br><span class="line">setTimeout - 2 - 1</span><br><span class="line">1s over</span><br></pre></td></tr></table></figure></p>
<h1>node环境</h1>
<p>六个阶段：</p>
<ol>
<li>timer (setTimeout 和 setInterval的回调)</li>
<li>I/O 回调</li>
<li>idle</li>
<li>poll</li>
<li>check (setImmediate回调)</li>
<li>close回调 (如socket.on('close',callback)的执行)
&lt;font color=&quot;red&quot;&gt;每一个阶段是一个queue(队列),清空了当前阶段的queue才会进入下一个阶段&lt;font&gt;</li>
</ol>
<p><strong>process.nextTick()会加入当前执行栈末尾，任务队列之前(也就是在所有异步任务之前执行)</strong>
<strong>setImmediate方法则是在当前&quot;任务队列&quot;的尾部添加事件</strong></p>
<p><strong>执行流程:</strong>
循环之前：同步任务，nextTick()
开始循环：当前阶段queue, nextTick() queue , Micortask queue, 下个阶段</p>
<p>代码示例：
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">new Promise((resolve) =&gt; &#123;</span><br><span class="line">    console.log(1);			</span><br><span class="line">    </span><br><span class="line">    process.nextTick(() =&gt; &#123;</span><br><span class="line">    	console.log(2);</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    resolve();</span><br><span class="line">    </span><br><span class="line">    setTimeout(() =&gt; &#123;</span><br><span class="line">    	console.log(6);</span><br><span class="line">	&#125;, 0);</span><br><span class="line">    </span><br><span class="line">    process.nextTick(() =&gt; &#123;</span><br><span class="line">    	console.log(3);</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    console.log(4);				</span><br><span class="line">&#125;).then(() =&gt; &#123;</span><br><span class="line">	process.nextTick(() =&gt; &#123;</span><br><span class="line">    	console.log(&apos;nextTick&apos;);</span><br><span class="line">    &#125;);</span><br><span class="line">    console.log(5);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">console.log(7);</span><br></pre></td></tr></table></figure></p>
<p>执行结果(node)：
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1</span><br><span class="line">4</span><br><span class="line">7</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">5</span><br><span class="line">nextTick</span><br><span class="line">6</span><br></pre></td></tr></table></figure></p>
<p>墙裂建议参考：
<a href="https://jakearchibald.com/2015/tasks-microtasks-queues-and-schedules/" target="_blank" rel="noopener">歪果大佬，提升英语水平</a>
<a href="https://cnodejs.org/topic/5a9108d78d6e16e56bb80882" target="_blank" rel="noopener">参考二</a>
<a href="https://github.com/SunShinewyf/issue-blog/issues/34#issuecomment-371106502" target="_blank" rel="noopener">github</a>
建议参考：
<a href="https://segmentfault.com/a/1190000013660033?utm_source=channel-hottest" target="_blank" rel="noopener">思否</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope="" itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/posts/34038/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/ava.png">
      <meta itemprop="name" content="dangsenlin">
      <meta itemprop="description" content="never giveup stronger survival">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="dang's technology blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/posts/34038/" class="post-title-link" itemprop="url">世界上最复杂的问题</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-06-28 01:35:37" itemprop="dateCreated datePublished" datetime="2020-06-28T01:35:37+08:00">2020-06-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-07-02 16:13:47" itemprop="dateModified" datetime="2020-07-02T16:13:47+08:00">2020-07-02</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/source/categories/网络/" itemprop="url" rel="index"><span itemprop="name">网络</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>从浏览器地址栏输入URL后回车，背后会进行哪些技术步骤？
这个问题我愿称之为世界上最复杂的问题，甚至可以从回车键的电流回路闭合或者触摸屏电容变化讲起，，，
<a href="https://www.zhihu.com/question/34873227" target="_blank" rel="noopener">知乎</a>
<a href="https://www.zhihu.com/question/34873227" target="_blank" rel="noopener">百度大佬</a></p>
<p>&lt;!-- more --&gt;</p>
<h1>从浏览器地址栏输入URL后回车，背后会进行哪些技术步骤</h1>
<h2>简单流程</h2>
<ol>
<li>浏览器分析URL</li>
<li>浏览器向DNS请求解析域名的IP</li>
<li>浏览器与服务器建立TCP链接(三次握手)</li>
<li>浏览器发出GET请求</li>
<li>服务器响应index.html页面</li>
<li>TCP链接释放</li>
<li>浏览器解析页面</li>
</ol>
<h2>说明</h2>
<ol>
<li>地址栏会先分析字符串是否符合URL的规则，符合则进行下一步</li>
<li>从域名到IP：</li>
</ol>
<ul>
<li>查缓存：浏览器缓存 -&gt; 系统缓存 -&gt; 路由缓存 -&gt; 系统hosts文件 ， 上述都没有则查询DNS服务器</li>
<li>查询DNS服务器：通过TCP/IP(中的UDP)联系<strong>本地</strong>DNS服务器8.8.8.8(自己的是1.1.1.1),一般由网络接入服务商提供(如中国移动)，DNS服务器也会查询自己的缓存 -&gt; 联系根域名服务器 -&gt;  根域名服务器给出一个域服务器地址让本地服务器去查 -&gt; 域服务器告诉本地服务器解析服务器地址继续让本地服务器去查 -&gt; 本地服务器缓存
<em>一个参数TTL(time to live)是本地DNS服务器缓存的时间，最长24h</em></li>
</ul>
<h2>TLS/SSL过程</h2>
<ol>
<li>client Hello: 客户端向服务端发送随机数Random1, SSL Version, 加密套件</li>
<li>server Hello: 服务端向客户端发送随机数Random2, 加密套件(从上一个加密套件得到的算法等)</li>
<li>certificate: 服务端将自己的证书下发给客户端</li>
<li>certificate verify:  客户端先从CA验证证书的合法性，再取出公钥，利用公钥加密Random3，生成premaster key</li>
<li>client key exchange： 服务端拿到premaster key后用私钥解密出Random3</li>
<li>client 和 client 使用 Random1 + Random2 + Random3 作为密钥进行加密通话</li>
</ol>
<h2>三次握手/四次挥手</h2>
<p>各字段意义：
SYN: 建立连接标志位
ACK: ack是否有效标志位
ack: 之前的信息成功接受
seq: 序号(分片后合并的依据)
FIN: 断开连接标志位</p>
<h3>三次握手</h3>
<p><img src="https://imgkr.cn-bj.ufileos.com/773e6bd2-b05d-4206-871f-ca431a11f6ce.png" alt="pic"></p>
<h3>四次挥手</h3>
<p><img src="https://imgkr.cn-bj.ufileos.com/981b6e65-0fc6-4218-a6cd-a416b7231b5b.png" alt="pic"></p>
<ul>
<li>
<p>为什么握手是三次，两次行吗？
首先明白三次握手的目的：第一次服务端知道了客户端有发送的能力，服务端有接受的能力；第二次客户端知道了服务端有接受和发送的能力，自己也有接受和发送到能力，但此时服务端还不知道客户端有没有接受的能力和服务端有没有发送的能力。<em>比如客户端握手一次没有响应再握手一次得到响应此时建立连接，传输数据断开连接完事第一次握手到达了服务端，此时服务端响应并一种等待数据造成了浪费</em></p>
</li>
<li>
<p>为什么握手是三次而挥手是四次？
四次挥手也可以理解成三次，将二三次合并就和三次握手一样了，之所以不能合并是因为第三次发送FIN是依据上一层(应用层)指令(有响应还没发完)，不能一起发送回复信息和FIN,所以一定有间隔。</p>
</li>
<li>
<p>三次握手可以携带数据吗？
<strong>第一次，第二次不可以</strong>,第三次可以：为了防止攻击服务器(第一次时携带大量数据让服务器解析)</p>
</li>
</ul>
<h2>TCP/UDP异同</h2>
<ol>
<li>UDP尽最大努力交付，不保证可靠， TCP可靠</li>
<li>TCP可靠，</li>
<li>TCP面向字节流，UDP面向报文
<em>如何理解面向报文与面向字节流，面向连接与无连接？</em>
面向报文：UDP面对应用层下发的信息（报文）,不做任何处理，直接发送报文。因此应用程序需选择合适的报文下发。
面向字节流：TCP有一个缓冲，将应用下发的数据块或进行拆分或进行合并再进行发送
面向连接；类似通电话，双方会确认（监听listen）
无连接：邮寄与邮箱, 收件人有空去取。
<a href="https://blog.csdn.net/ce123_zhouwei/article/details/8976006" target="_blank" rel="noopener">TCP/UDP</a></li>
</ol>
<p><a href="https://blog.csdn.net/ce123_zhouwei/article/details/8976006" target="_blank" rel="noopener">参考</a>
<a href="https://zhuanlan.zhihu.com/p/53374516" target="_blank" rel="noopener">参考</a>
<a href="https://segmentfault.com/a/1190000020610336" target="_blank" rel="noopener">参考</a></p>
<h2>浏览器对响应的解析</h2>
<p><em>extra:</em>
不同于ISO的七层模型，TCP/IP是四层模型，如图：
<img src="https://imgkr.cn-bj.ufileos.com/f259bd90-7f92-47b3-834f-6bb1980e311b.jpg" alt="pic"></p>
<ul>
<li>应用层：HTTP, SNMP, FTP, TFTP, DNS,</li>
<li>传输层：TCP, UDP</li>
<li>网络层：IP, ICMP, OSPF, IGMP</li>
<li>网络接口层：SLIP, CSLIP, MTU</li>
</ul>
<p>套接字(Socket)
<em>网络层提供的是主机到主机之间的通信</em>
<em>传输层提供的是进程到进程之间的通信</em>
Socket是应用层和传输层之间的一层抽象。如图：
<img src="https://imgkr.cn-bj.ufileos.com/f4279a87-eae4-43ec-83af-c5a78aaebb0a.jpg" alt="pic">
把主机比作一个房子，进程比作方子中的一个个房间，Socket就相当于房间上的门，从房子到房间进出须经过这一道门。
Socket的作用是实现传输层的多路复用和多路分解,在应用层可以同时运行多个进程，每个进程都需要通过传输层来收发分组，而传输层的TCP进程只有一个，当TCP进程收到一个分组后，该怎么确定应该转发给哪个进程呢？答案是通过套接字，这就是多路分解。同样的道理，多路复用就是进程将分组通过各自的套接字转发给传输层。TCP套接字是由一个四元组（源IP地址、源端口号、目的IP地址和目的端口号）来标识的。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope="" itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/posts/45598/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/ava.png">
      <meta itemprop="name" content="dangsenlin">
      <meta itemprop="description" content="never giveup stronger survival">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="dang's technology blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/posts/45598/" class="post-title-link" itemprop="url">HTTP缓存</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-06-28 01:35:12 / 修改时间：13:47:12" itemprop="dateCreated datePublished" datetime="2020-06-28T01:35:12+08:00">2020-06-28</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/source/categories/网络/" itemprop="url" rel="index"><span itemprop="name">网络</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>浏览器缓存包括：HTTP缓存，indexDB，cookie，localstorage.现对HTTP缓存稍做分析
&lt;!-- more --&gt;</p>
<p>HTTP缓存分为<strong>强缓存</strong>和<strong>协商缓存</strong>，大致流程是先检查强缓存，可以使用则直接使用缓存，否则发请求检测协商缓存，可以使用则使用缓存，否则从服务器获取资源。
<img src="https://static01.imgkr.com/temp/b95afd6664b84760b061f3ed9b558ece.jpg" alt="pic"></p>
<h1>强缓存</h1>
<h2>Expires</h2>
<p>Expires具体指资源的到期时间，超过这个时间表过期资源。
HTTP1.0标准
缺点是由于使用了具体的日期（年月日时分秒），可能由于时区，当前时间获取错误等原因容易导致错误。</p>
<h2>Cache-Control</h2>
<p>HTTP1.1标准
有以下字段组成：</p>
<ol>
<li><strong>max-age</strong>：指一个时间长度，多长时间之后过期</li>
<li><strong>no-cache</strong>: 强制所有缓存了该响应的用户，在使用已缓存的数据前，发送带验证器的请求到服务器。不是字面意思上的不缓存。</li>
<li><strong>no-store</strong>: 禁止缓存。</li>
</ol>
<p>&lt;font color=&quot;red&quot;&gt;Cache-Control优先级高于Expires(使用了时间长度而非具体时间更合理)&lt;/font&gt;</p>
<h1>协商缓存</h1>
<p>强缓存没有命中说明过期了，但是过期不一定就是资源修改不能使用缓存了，这时判断协商缓存</p>
<h2>Last-Motified/If-Modified-Since</h2>
<p>Last-Motified是指服务端最后一次修改资源的时间，响应头部会带上这个标识。浏览器第一次请求之后，会记录这个时间，下次请求时，请求头部的If-Motified-Since即为之前记录的时间。服务端收到If-Motified-Since后会对比，如果修改过就返回最新资源，状态码200，如果没有修改过，返回304.
<img src="https://static01.imgkr.com/temp/b1ace672e50b40d298aa6d42404f66ca.jpg" alt="pic"></p>
<h2>Etag/If-None-Match</h2>
<p>由服务器端上生成的一段 hash 字符串，第一次请求时响应头带上 ETag，之后的浏览器请求会携带上If-None-Match，服务端检查Etag，返回200或304
<img src="https://static01.imgkr.com/temp/091f47e8da8e4945b4b9e2d30cc821ef.jpg" alt="pic"></p>
<p>&lt;font color=&quot;red&quot;&gt;Etag的优先级高于Last-Motified(还是时间的问题，hash值的话不存在这个问题)&lt;/font&gt;</p>
<p><a href="https://zhuanlan.zhihu.com/p/29750583" target="_blank" rel="noopener">参考</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope="" itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/posts/56868/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/ava.png">
      <meta itemprop="name" content="dangsenlin">
      <meta itemprop="description" content="never giveup stronger survival">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="dang's technology blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/posts/56868/" class="post-title-link" itemprop="url">关于跨域</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-06-27 20:10:35" itemprop="dateCreated datePublished" datetime="2020-06-27T20:10:35+08:00">2020-06-27</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-06-28 13:36:29" itemprop="dateModified" datetime="2020-06-28T13:36:29+08:00">2020-06-28</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/source/categories/浏览器/" itemprop="url" rel="index"><span itemprop="name">浏览器</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>hahaha, hello everyone, shit hexo ,this is a seat of seize !_!
&lt;!-- more --&gt;</p>
<h1>同源策略</h1>
<p>同源是指： <strong>协议</strong> <strong>url</strong> <strong>端口</strong> 一致</p>
<p>两个例子理解为什么会出现同源限制：</p>
<ol>
<li>如果百度的后台没有做同源限制，那么别人随便编写一个页面将结果返回给百度后台，再展示响应结果。这样一个搜索引擎似乎就完成了，但是百度后台肯定不会这么干。</li>
<li>购物网站存储了cookie，如果没有同源限制，恶意网站就会获取到cookie以及购物网站的个人信息。</li>
</ol>
<p>同源策略限制以下行为：</p>
<ul>
<li>DOM操作</li>
<li>Ajax</li>
<li>Cookie, LocalStorage, IndexDB</li>
</ul>
<h1>跨域</h1>
<h2>jsonp</h2>
<ol>
<li>申明一个回调函数，函数名当作url参数值，函数的形参为要获取的数据（服务端返回的数据）</li>
<li>创建一个script标签，src为目标地址（参数中传递申明的回调函数）</li>
<li>服务端收到请求之后，将参数中的函数与要返回到数据拼成一个字符串返回</li>
<li>客户端收到响应后，拿到了回调函数的实参，调用回调函数
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">// Client</span><br><span class="line">function jsonp(&#123; url, params, callback &#125;) &#123;</span><br><span class="line">  return new Promise((resolve, reject) =&gt; &#123;</span><br><span class="line">    let script = document.createElement(&apos;script&apos;)</span><br><span class="line">    window[callback] = function(data) &#123;</span><br><span class="line">      resolve(data)</span><br><span class="line">      document.body.removeChild(script)</span><br><span class="line">    &#125;</span><br><span class="line">    params = &#123; ...params, callback &#125; // wd=b&amp;callback=show</span><br><span class="line">    let arrs = []</span><br><span class="line">    for (let key in params) &#123;</span><br><span class="line">      arrs.push(`$&#123;key&#125;=$&#123;params[key]&#125;`)</span><br><span class="line">    &#125;</span><br><span class="line">    script.src = `$&#123;url&#125;?$&#123;arrs.join(&apos;&amp;&apos;)&#125;`</span><br><span class="line">    document.body.appendChild(script)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line">jsonp(&#123;</span><br><span class="line">  url: &apos;http://localhost:3000/say&apos;,</span><br><span class="line">  params: &#123; wd: &apos;Iloveyou&apos; &#125;,</span><br><span class="line">  callback: &apos;show&apos;</span><br><span class="line">&#125;).then(data =&gt; &#123;</span><br><span class="line">  console.log(data)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li>
</ol>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">// Server</span><br><span class="line">let express = require(&apos;express&apos;)</span><br><span class="line">let app = express()</span><br><span class="line">app.get(&apos;/say&apos;, function(req, res) &#123;</span><br><span class="line">  let &#123; wd, callback &#125; = req.query</span><br><span class="line">  console.log(wd) // Iloveyou</span><br><span class="line">  console.log(callback) // show</span><br><span class="line">  res.end(`$&#123;callback&#125;(&apos;我不爱你&apos;)`)</span><br><span class="line">&#125;)</span><br><span class="line">app.listen(3000)</span><br></pre></td></tr></table></figure></p>
<p>jsonp方式跨域最大的问题是只支持&lt;font color='red'&gt;GET&lt;/font&gt;方式。</p>
<h2>CORS</h2>
<p>CORS是一个W3C标准，全称是&quot;跨域资源共享&quot;（Cross-origin resource sharing）。 它允许浏览器向跨源服务器，发出XMLHttpRequest请求，从而克服了AJAX只能同源使用的限制。
CORS对于前端来说是没有什么特殊的，因为浏览器自动执行，与同源的AJAX通信没有差别，代码完全一样。<strong>浏览器一旦发现AJAX请求跨源，就会自动添加一些附加的头信息，有时还会多出一次附加的请求。</strong></p>
<h2>简单请求</h2>
<p>满足以下条件就是简单请求：</p>
<ul>
<li>请求方式为HEAD、POST 或者 GET</li>
<li>Content-Type值为text/plain 或 multipart/form-data 或 application/x-www-form-urlencoded</li>
</ul>
<p>对于简单请求，浏览器直接发出CORS请求。具体来说，就是在头信息之中，增加一个Origin字段。
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">GET /cors HTTP/1.1</span><br><span class="line">Origin: http://api.bob.com</span><br><span class="line">Host: api.alice.com</span><br><span class="line">Accept-Language: en-US</span><br><span class="line">Connection: keep-alive</span><br><span class="line">User-Agent: Mozilla/5.0</span><br></pre></td></tr></table></figure></p>
<p>服务器根据<strong>Origin</strong>字段来判断请求来自哪个源，以及是否接受请求。</p>
<ul>
<li>
<p>如果不接受，服务器会返回一个正常的HTTP回应。 浏览器发现，这个回应的头信息没有包含Access-Control-Allow-Origin字段，就知道出错了，从而抛出一个错误，被XMLHttpRequest的onerror回调函数捕获。</p>
</li>
<li>
<p>如果接受，服务器返回的响应，会多出几个头信息字段：
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Access-Control-Allow-Origin: http://api.bob.com</span><br><span class="line">Access-Control-Allow-Credentials: true</span><br><span class="line">Access-Control-Expose-Headers: FooBar</span><br><span class="line">Content-Type: text/html; charset=utf-8</span><br></pre></td></tr></table></figure></p>
</li>
<li>
<p>Access-Control-Allow-Origin :该字段是必须的。它的值要么是请求时Origin字段的值，要么是一个*，表示接受任意域名的请求</p>
</li>
<li>
<p>Access-Control-Allow-Credentials: 该字段可选。它的值是一个布尔值，表示是否允许发送Cookie。默认情况下，Cookie不包括在CORS请求之中。设为true，即表示服务器明确许可，Cookie可以包含在请求中，一起发给服务器。这个值也只能设为true，如果服务器不要浏览器发送Cookie，删除该字段即可。</p>
</li>
<li>
<p>Access-Control-Expose-Headers:该字段可选。CORS请求时，XMLHttpRequest对象的getResponseHeader()方法只能拿到6个基本字段：Cache-Control、Content-Language、Content-Type、Expires、Last-Modified、Pragma。如果想拿到其他字段，就必须在Access-Control-Expose-Headers里面指定。</p>
</li>
</ul>
<p><strong>withCredentials</strong>
CORS请求默认不发送Cookie和HTTP认证信息。如果要把Cookie发到服务器，一方面要服务器同意，指定Access-Control-Allow-Credentials字段。另一方面，开发者必须在AJAX请求中打开withCredentials属性。
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">var xhr = new XMLHttpRequest(); // IE8/9需用window.XDomainRequest兼容</span><br><span class="line"></span><br><span class="line">// 前端设置是否带cookie</span><br><span class="line">xhr.withCredentials = true;</span><br><span class="line"></span><br><span class="line">xhr.open(&apos;post&apos;, &apos;http://www.domain2.com:8080/login&apos;, true);</span><br><span class="line">xhr.setRequestHeader(&apos;Content-Type&apos;, &apos;application/x-www-form-urlencoded&apos;);</span><br><span class="line">xhr.send(&apos;user=admin&apos;);</span><br><span class="line"></span><br><span class="line">xhr.onreadystatechange = function() &#123;</span><br><span class="line">    if (xhr.readyState == 4 &amp;&amp; xhr.status == 200) &#123;</span><br><span class="line">        alert(xhr.responseText);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">// jquery</span><br><span class="line">$.ajax(&#123;</span><br><span class="line">    ...</span><br><span class="line">   xhrFields: &#123;</span><br><span class="line">       withCredentials: true    // 前端设置是否带cookie</span><br><span class="line">   &#125;,</span><br><span class="line">   crossDomain: true,   // 会让请求头中包含跨域的额外信息，但不会含cookie</span><br><span class="line">    ...</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p><em>需要注意的是，如果要发送Cookie，Access-Control-Allow-Origin就不能设为星号，必须指定明确的、与请求网页一致的域名。同时，Cookie依然遵循同源政策，只有用服务器域名设置的Cookie才会上传，其他域名的Cookie并不会上传，且（跨源）原网页代码中的document.cookie也无法读取服务器域名下的Cookie。</em></p>
<h2>非简单请求</h2>
<p>请求方法是PUT或DELETE，或者Content-Type字段的类型是application/json。
非简单请求的CORS请求，会在正式通信之前，增加一次HTTP查询请求，称为&quot;预检&quot;请求。&lt;font color='red'&gt;OPTIONS方式&lt;/font&gt;
浏览器先询问服务器，当前网页所在的域名是否在服务器的许可名单之中，以及可以使用哪些HTTP动词和头信息字段。只有得到肯定答复，浏览器才会发出正式的XMLHttpRequest请求，否则就报错。
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">var url = &apos;http://api.alice.com/cors&apos;;</span><br><span class="line">var xhr = new XMLHttpRequest();</span><br><span class="line">xhr.open(&apos;PUT&apos;, url, true);</span><br><span class="line">xhr.setRequestHeader(&apos;X-Custom-Header&apos;, &apos;value&apos;);</span><br><span class="line">xhr.send();</span><br></pre></td></tr></table></figure></p>
<p>浏览器发现，这是一个非简单请求，就自动发出一个&quot;预检&quot;请求，要求服务器确认可以这样请求。下面是这个&quot;预检&quot;请求的HTTP头信息。
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">OPTIONS /cors HTTP/1.1</span><br><span class="line"> Origin: http://api.bob.com</span><br><span class="line"> Access-Control-Request-Method: PUT</span><br><span class="line"> Access-Control-Request-Headers: X-Custom-Header</span><br><span class="line"> Host: api.alice.com</span><br><span class="line"> Accept-Language: en-US</span><br><span class="line"> Connection: keep-alive</span><br><span class="line"> User-Agent: Mozilla/5.0...</span><br></pre></td></tr></table></figure></p>
<p>除了Origin字段，&quot;预检&quot;请求的头信息包括两个特殊字段。</p>
<ul>
<li>Access-Control-Request-Method：该字段是必须的，用来列出浏览器的CORS请求会用到哪些HTTP方法，上例是PUT。</li>
<li>Access-Control-Request-Headers：该字段是一个逗号分隔的字符串，指定浏览器CORS请求会额外发送的头信息字段，上例是X-Custom-Header</li>
</ul>
<p>响应：
服务器收到&quot;预检&quot;请求以后，检查了Origin、Access-Control-Request-Method和Access-Control-Request-Headers字段以后，确认允许跨源请求，就可以做出回应
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Date: Mon, 01 Dec 2008 01:15:39 GMT</span><br><span class="line">Server: Apache/2.0.61 (Unix)</span><br><span class="line">Access-Control-Allow-Origin: http://api.bob.com</span><br><span class="line">Access-Control-Allow-Methods: GET, POST, PUT</span><br><span class="line">Access-Control-Allow-Headers: X-Custom-Header</span><br><span class="line">Content-Type: text/html; charset=utf-8</span><br><span class="line">Content-Encoding: gzip</span><br><span class="line">Content-Length: 0</span><br><span class="line">Keep-Alive: timeout=2, max=100</span><br><span class="line">Connection: Keep-Alive</span><br><span class="line">Content-Type: text/plain</span><br></pre></td></tr></table></figure></p>
<p>上面的HTTP回应中，关键的是Access-Control-Allow-Origin字段，表示http://api.bob.com可以请求数据。该字段也可以设为星号，表示同意任意跨源请求。</p>
<p>如果服务器不接受请求，则返回一个正常HTTP响应，里边没有关于CORS的字段，客户端的XMLHttPRequest对象就会捕捉到错误，触发onerror回调
如果接受，回应字段如下：
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Access-Control-Allow-Methods: GET, POST, PUT</span><br><span class="line">Access-Control-Allow-Headers: X-Custom-Header</span><br><span class="line">Access-Control-Allow-Credentials: true</span><br><span class="line">Access-Control-Max-Age: 1728000</span><br></pre></td></tr></table></figure></p>
<p>Access-Control-Allow-Methods：该字段必需，它的值是逗号分隔的一个字符串，表明服务器支持的所有跨域请求的方法。注意，返回的是所有支持的方法，而不单是浏览器请求的那个方法。这是为了避免多次&quot;预检&quot;请求。</p>
<p>注意：一旦服务器通过了&quot;预检&quot;请求，以后每次浏览器正常的CORS请求，就都跟简单请求一样，会有一个Origin头信息字段。服务器的回应，也都会有一个Access-Control-Allow-Origin头信息字段。</p>
<h1>node中间代理</h1>
<p>前端代码：
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">var xhr = new XMLHttpRequest();</span><br><span class="line"></span><br><span class="line">// 前端开关：浏览器是否读写cookie</span><br><span class="line">xhr.withCredentials = true;</span><br><span class="line"></span><br><span class="line">// 访问http-proxy-middleware代理服务器</span><br><span class="line">xhr.open(&apos;get&apos;, &apos;http://www.domain1.com:3000/login?user=admin&apos;, true);</span><br><span class="line">xhr.send();</span><br></pre></td></tr></table></figure></p>
<p>服务端代码：
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">var express = require(&apos;express&apos;);</span><br><span class="line">var proxy = require(&apos;http-proxy-middleware&apos;);</span><br><span class="line">var app = express();</span><br><span class="line"></span><br><span class="line">app.use(&apos;/&apos;, proxy(&#123;</span><br><span class="line">    // 代理跨域目标接口</span><br><span class="line">    target: &apos;http://www.domain2.com:8080&apos;,</span><br><span class="line">    changeOrigin: true,</span><br><span class="line"></span><br><span class="line">    // 修改响应头信息，实现跨域并允许带cookie</span><br><span class="line">    onProxyRes: function(proxyRes, req, res) &#123;</span><br><span class="line">        res.header(&apos;Access-Control-Allow-Origin&apos;, &apos;http://www.domain1.com&apos;);</span><br><span class="line">        res.header(&apos;Access-Control-Allow-Credentials&apos;, &apos;true&apos;);</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    // 修改响应信息中的cookie域名</span><br><span class="line">    cookieDomainRewrite: &apos;www.domain1.com&apos;  // 可以为false，表示不修改</span><br><span class="line">&#125;));</span><br><span class="line"></span><br><span class="line">app.listen(3000);</span><br><span class="line">console.log(&apos;Proxy server is listen at port 3000...&apos;);</span><br></pre></td></tr></table></figure></p>
<h1>nginx反向代理</h1>
<p>跨域原理： 同源策略是浏览器的安全策略，不是HTTP协议的一部分。服务器端调用HTTP接口只是使用HTTP协议，不会执行JS脚本，不需要同源策略，也就不存在跨越问题。
实现思路：通过nginx配置一个代理服务器（域名与domain1相同，端口不同）做跳板机，反向代理访问domain2接口，并且可以顺便修改cookie中domain信息，方便当前域cookie写入，实现跨域登录。</p>
<h1>webSocket</h1>
<p>WebSocket protocol是HTML5一种新的协议。它实现了浏览器与服务器全双工通信，同时允许跨域通讯，是server push技术的一种很好的实现。
原生WebSocket API使用起来不太方便，我们使用Socket.io，它很好地封装了webSocket接口，提供了更简单、灵活的接口，也对不支持webSocket的浏览器提供了向下兼容。
前端代码：
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;div&gt;user input：&lt;input type=&quot;text&quot;&gt;&lt;/div&gt;</span><br><span class="line">&lt;script src=&quot;./socket.io.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">var socket = io(&apos;http://www.domain2.com:8080&apos;);</span><br><span class="line"></span><br><span class="line">// 连接成功处理</span><br><span class="line">socket.on(&apos;connect&apos;, function() &#123;</span><br><span class="line">    // 监听服务端消息</span><br><span class="line">    socket.on(&apos;message&apos;, function(msg) &#123;</span><br><span class="line">        console.log(&apos;data from server: ---&gt; &apos; + msg); </span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    // 监听服务端关闭</span><br><span class="line">    socket.on(&apos;disconnect&apos;, function() &#123; </span><br><span class="line">        console.log(&apos;Server socket has closed.&apos;); </span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">document.getElementsByTagName(&apos;input&apos;)[0].onblur = function() &#123;</span><br><span class="line">    socket.send(this.value);</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure></p>
<p>后端代码：
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">var http = require(&apos;http&apos;);</span><br><span class="line">var socket = require(&apos;socket.io&apos;);</span><br><span class="line"></span><br><span class="line">// 启http服务</span><br><span class="line">var server = http.createServer(function(req, res) &#123;</span><br><span class="line">    res.writeHead(200, &#123;</span><br><span class="line">        &apos;Content-type&apos;: &apos;text/html&apos;</span><br><span class="line">    &#125;);</span><br><span class="line">    res.end();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">server.listen(&apos;8080&apos;);</span><br><span class="line">console.log(&apos;Server is running at port 8080...&apos;);</span><br><span class="line"></span><br><span class="line">// 监听socket连接</span><br><span class="line">socket.listen(server).on(&apos;connection&apos;, function(client) &#123;</span><br><span class="line">    // 接收信息</span><br><span class="line">    client.on(&apos;message&apos;, function(msg) &#123;</span><br><span class="line">        client.send(&apos;hello：&apos; + msg);</span><br><span class="line">        console.log(&apos;data from client: ---&gt; &apos; + msg);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    // 断开处理</span><br><span class="line">    client.on(&apos;disconnect&apos;, function() &#123;</span><br><span class="line">        console.log(&apos;Client socket has closed.&apos;); </span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<h1>document.domain</h1>
<p>要求主域名相同，结合iframe实现
...</p>
<p><a href="https://www.jianshu.com/p/a0dd1e712c3a" target="_blank" rel="noopener">详细参考</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope="" itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/posts/42543/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/ava.png">
      <meta itemprop="name" content="dangsenlin">
      <meta itemprop="description" content="never giveup stronger survival">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="dang's technology blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/posts/42543/" class="post-title-link" itemprop="url">async/await及相关思考</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-06-26 16:55:29" itemprop="dateCreated datePublished" datetime="2020-06-26T16:55:29+08:00">2020-06-26</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-06-28 13:50:17" itemprop="dateModified" datetime="2020-06-28T13:50:17+08:00">2020-06-28</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/source/categories/JavaScript/" itemprop="url" rel="index"><span itemprop="name">JavaScript</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>JS关于异步编程的解决方案:
&lt;!-- more --&gt;</p>
<ol>
<li>回调函数
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ajax(url, () =&gt; &#123;</span><br><span class="line">    // 处理逻辑</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li>
</ol>
<p>缺点：容易写出<strong>回调地狱</strong></p>
<ol start="2">
<li>事件监听
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">f1.on(&apos;done&apos;, f2);</span><br></pre></td></tr></table></figure></li>
</ol>
<p>缺点：整个程序都要变成事件驱动型，运行流程会变得很不清晰。阅读代码的时候，很难看出主流程。</p>
<ol start="3">
<li>发布订阅/观察者模式</li>
<li>promise， generator 与 async/await</li>
</ol>
<h1>Promise</h1>
<p>如上所述，回调函数的缺点是容易写出回调地狱，导致代码难以阅读和维护，以及混乱的错误处理（可能每一次回调都需专门的错误处理，而promise只需要在最后catch就行）。</p>
<h2>构造函数promise</h2>
<p>参数是一个函数，函数的两个参数分别是resolve和reject</p>
<h2>then</h2>
<p>在实例之后.then,参数是两个函数，第一个函数是resolve时执行，第二个函数时reject时执行。*每个函数的参数是之前resolve或reject传过来的。</p>
<h2>catch</h2>
<p>一般在then之后catch。相当于then的第二个参数。这样做的好处是<strong>既可以捕获实例的错误，也可以捕获then的错误</strong></p>
<h2>all</h2>
<p>参数是一个数组，数组的每一项都是promise，如果每一项都resolve，将各项的返回值组成一个数组返回给回调函数，如果有一个reject，将这个reject项的结果返回给回调函数。
<strong>all各项的执行是并发的，可以节约时间</strong></p>
<h2>race</h2>
<p>数组中有一个resolve，将那个项的结果返回给回调函数。<strong>典型应用：规定时间内请求一个接口，超时则返回</strong></p>
<h1>async/await</h1>
<p><strong>async函数中遇到await的地方（是promise）会等待其resolve再执行下面的代码（回调函数）</strong>
但问题在于promise中一大堆then似乎并不优雅，并且有时候不得不在then还得执行then，错误捕获也不完美（匿名函数）,所以async/await出现了。他将异步代码以同步的形式表现出来。</p>
<h2>一个例子</h2>
<p>假设一个业务，分多个步骤完成，每个步骤都是异步的，而且依赖于上一个步骤的结果。我们仍然用 setTimeout 来模拟异步操作：
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 传入参数 n，表示这个函数执行的时间（毫秒）</span><br><span class="line"> * 执行的结果是 n + 200，这个值将用于下一步骤</span><br><span class="line"> */</span><br><span class="line">function takeLongTime(n) &#123;</span><br><span class="line">    return new Promise(resolve =&gt; &#123;</span><br><span class="line">        setTimeout(() =&gt; resolve(n + 200), n);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function step1(n) &#123;</span><br><span class="line">    console.log(`step1 with $&#123;n&#125;`);</span><br><span class="line">    return takeLongTime(n);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function step2(n) &#123;</span><br><span class="line">    console.log(`step2 with $&#123;n&#125;`);</span><br><span class="line">    return takeLongTime(n);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function step3(n) &#123;</span><br><span class="line">    console.log(`step3 with $&#123;n&#125;`);</span><br><span class="line">    return takeLongTime(n);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>promise
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">function doIt() &#123;</span><br><span class="line">    console.time(&quot;doIt&quot;);</span><br><span class="line">    const time1 = 300;</span><br><span class="line">    step1(time1)</span><br><span class="line">        .then(time2 =&gt; step2(time2))</span><br><span class="line">        .then(time3 =&gt; step3(time3))</span><br><span class="line">        .then(result =&gt; &#123;</span><br><span class="line">            console.log(`result is $&#123;result&#125;`);</span><br><span class="line">            console.timeEnd(&quot;doIt&quot;);</span><br><span class="line">        &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">doIt();</span><br><span class="line">// c:\var\test&gt;node --harmony_async_await .</span><br><span class="line">// step1 with 300</span><br><span class="line">// step2 with 500</span><br><span class="line">// step3 with 700</span><br><span class="line">// result is 900</span><br><span class="line">// doIt: 1507.251ms</span><br></pre></td></tr></table></figure></p>
<p>async:
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">async function doIt() &#123;</span><br><span class="line">    console.time(&quot;doIt&quot;);</span><br><span class="line">    const time1 = 300;</span><br><span class="line">    const time2 = await step1(time1);</span><br><span class="line">    const time3 = await step2(time2);</span><br><span class="line">    const result = await step3(time3);</span><br><span class="line">    console.log(`result is $&#123;result&#125;`);</span><br><span class="line">    console.timeEnd(&quot;doIt&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">doIt();</span><br></pre></td></tr></table></figure></p>
<p>现在把业务要求改一下，仍然是三个步骤，但每一个步骤都需要之前每个步骤的结果
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">function step1(n) &#123;</span><br><span class="line">    console.log(`step1 with $&#123;n&#125;`);</span><br><span class="line">    return takeLongTime(n);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function step2(m, n) &#123;</span><br><span class="line">    console.log(`step2 with $&#123;m&#125; and $&#123;n&#125;`);</span><br><span class="line">    return takeLongTime(m + n);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function step3(k, m, n) &#123;</span><br><span class="line">    console.log(`step3 with $&#123;k&#125;, $&#123;m&#125; and $&#123;n&#125;`);</span><br><span class="line">    return takeLongTime(k + m + n);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>promise:
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">function doIt() &#123;</span><br><span class="line">    console.time(&quot;doIt&quot;);</span><br><span class="line">    const time1 = 300;</span><br><span class="line">    step1(time1)</span><br><span class="line">        .then(time2 =&gt; &#123;</span><br><span class="line">            return step2(time1, time2)</span><br><span class="line">                .then(time3 =&gt; [time1, time2, time3]);</span><br><span class="line">        &#125;)</span><br><span class="line">        .then(times =&gt; &#123;</span><br><span class="line">            const [time1, time2, time3] = times;</span><br><span class="line">            return step3(time1, time2, time3);</span><br><span class="line">        &#125;)</span><br><span class="line">        .then(result =&gt; &#123;</span><br><span class="line">            console.log(`result is $&#123;result&#125;`);</span><br><span class="line">            console.timeEnd(&quot;doIt&quot;);</span><br><span class="line">        &#125;);</span><br><span class="line">&#125;</span><br><span class="line">doIt();</span><br></pre></td></tr></table></figure></p>
<p>async:
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">async function doIt() &#123;</span><br><span class="line">    console.time(&quot;doIt&quot;);</span><br><span class="line">    const time1 = 300;</span><br><span class="line">    const time2 = await step1(time1);</span><br><span class="line">    const time3 = await step2(time1, time2);</span><br><span class="line">    const result = await step3(time1, time2, time3);</span><br><span class="line">    console.log(`result is $&#123;result&#125;`);</span><br><span class="line">    console.timeEnd(&quot;doIt&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">doIt();</span><br></pre></td></tr></table></figure></p>
<p><a href="https://segmentfault.com/a/1190000007535316" target="_blank" rel="noopener">参考</a></p>
<h2>原理（自动执行机）</h2>
<p>async实际就是generator函数的语法糖（generator + 自动执行机）
最简单的自动执行机：
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">function spawn(genF) &#123;</span><br><span class="line">  return new Promise(function(resolve, reject) &#123;</span><br><span class="line">    const gen = genF();</span><br><span class="line">    function step(nextF) &#123;</span><br><span class="line">      let next;</span><br><span class="line">      next = nextF();</span><br><span class="line">      if(next.done) &#123;</span><br><span class="line">        return resolve(next.value);</span><br><span class="line">      &#125;</span><br><span class="line">      Promise.resolve(next.value).then(function(v) &#123;</span><br><span class="line">        step(function() &#123; return gen.next(v); &#125;);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    step(function() &#123; return gen.next(undefined); &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2>注意</h2>
<p>当async函数中多个异步操作没有依赖关系时，不适合写成多个await（因为await同步执行，会阻塞）,此时应考虑promise.all()</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

  </div>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="dangsenlin" src="/images/ava.png">
  <p class="site-author-name" itemprop="name">dangsenlin</p>
  <div class="site-description" itemprop="description">never giveup stronger survival</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">20</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">8</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">30</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">dangsenlin</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://mist.theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script>
<script src="/js/schemes/muse.js"></script>
<script src="/js/next-boot.js"></script>



  















  

  

</body>
</html>
